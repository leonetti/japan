jQuery.noConflict(),function(c){c(document).ready(function(t){var i,d,o;i=window.Japan.Activities=window.Japan.Activities||{},d=firebase.firestore().collection("activities"),o=firebase.storage(),(i=function(t){this.cfg=_.extend({selectors:{activities_wrapper:".activities--wrapper",grid_wrapper:".activities--wrapper--grid",grid:".activities--wrapper--grid .grid",content_wrapper:".activities--content--wrapper"},templates:{activity_description:'[data-template="activity_description"]',activity_button:'[data-template="activity_button"]'}}),this.activities=[],this.getDOMRefs(),this.bindHandlers(),this.buildTemplates(),this.checkUserName(),this.getActivities()}).prototype.getDOMRefs=function(){this.$dom=this.$dom||{},_.forOwn(this.cfg.selectors,function(t,i){this.$dom[i]=c(t),this.$dom[i].length||console.log("Login Developer Warning: Selected element not found")}.bind(this))},i.prototype.buildTemplates=function(){this.templates=this.templates||{},_.forOwn(this.cfg.templates,function(t,i){var e=c(t);e.length?this.templates[i]=_.template(e.html()):window.Japan.Error.handlerShowError("Activities: Template Can't be build.")}.bind(this))},i.prototype.bindHandlers=function(){this.$dom.grid.on("click",".grid--item",this.handlerGridClick.bind(this)),this.$dom.grid.on("click","[data-add-item]",this.handlerAddUserActivity.bind(this,"grid")),this.$dom.content_wrapper.on("click","[data-add-item]",this.handlerAddUserActivity.bind(this,"content")),this.$dom.content_wrapper.on("click",".close--content",this.handlerCloseContent.bind(this))},i.prototype.handlerGridClick=function(t){var i=c(t.target).closest(".grid--item"),e=i.find(".loader").addClass("active"),s=i.data("ref");setTimeout(function(){this.$dom.grid.fadeOut("slow")}.bind(this),500),setTimeout(function(){e.removeClass("active"),c(this.$dom.content_item[s]).fadeIn("slow")}.bind(this),1e3)},i.prototype.handlerCloseContent=function(t){this.$dom.content_item.fadeOut("slow"),this.$dom.grid.fadeIn("slow")},i.prototype.handlerAddUserActivity=function(t,i){i.preventDefault(),i.stopPropagation();var e="grid"===t?c(i.target).closest(".grid--item").attr("data-activity-id"):c(i.target).closest(".content--show").attr("data-activity-id"),s=JSON.parse(localStorage.getItem("user")),a=_.findIndex(this.activities,{id:e}),o=this.activities[a],n=o.users,r=_.findIndex(n,s);console.log("user index: ",r),-1===r?(n.push({email:s.email,name:s.name}),console.log("users: ",n),d.doc(e).update({users:n}),window.Japan.Error.handlerShowError("Added Activity: "+o.title+" to your list!",!0),this.getActivities(),this.$dom.grid.fadeIn("slow"),this.$dom.content_item.fadeOut("slow")):window.Japan.Error.handlerShowError("Activity: "+o.title+" already is in your list!",!0)},i.prototype.checkUserName=function(){var t=JSON.parse(localStorage.getItem("user"));if(!t.name){c("#settings--modal .form--show--button,#settings--modal .user--logout").hide();var i=c('[data-update-text="name"]').closest(".input--wrapper");i.show(),i.prev(".update--label").show(),c(".form--back").show().attr("disabled",!0),c(".update--submit").css("display","block"),c("#settings--modal").modal({fadeDuration:500,fadeDelay:.5,escapeClose:!1,clickClose:!1,showClose:!1}),c("[data-update-submit]").on("click",function(t){c(".form--back").attr("disabled",!1)})}t&&(c("[data-user-name]").text(t.name),c("[data-user-email]").html(t.email+' <i class="fas fa-cog"></i>'))},i.prototype.getActivities=function(){this.activities=[];var s=[],a=[];d.get().then(function(t){s.push(t.docs.map(function(t){this.activities.push(_.extend(t.data(),{id:t.id}))}.bind(this))),_.each(this.activities,function(t,i){var e=t.title;o.ref(e)&&s.push(o.ref(e).getDownloadURL().then(function(t){var i={};i[e]=t,a.push(i)}.bind(this)))}.bind(this)),Promise.all(s).then(function(){_.each(a,function(t){var i=Object.keys(t)[0],e=_.findIndex(this.activities,{title:i}),s=this.activities.splice(e,1)[0];console.log("activity: ",s),s.image=t[i],this.activities.push(s)}.bind(this)),this.activities=_.orderBy(this.activities,"title"),this.$dom.grid.html(this.templates.activity_button({activities:this.activities})),this.$dom.content_wrapper.html(this.templates.activity_description({activities:this.activities})),this.$dom.content_item=c(".activities--content--wrapper .content--show")}.bind(this))}.bind(this)).catch(function(t){window.Japan.Error.handlerShowError("Error getting activities: "+t)}.bind(this))},i.prototype.emptyActivities=function(){this.$dom.grid.empty()},window.Japan.Activities=new i})}(jQuery);