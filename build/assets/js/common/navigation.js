document.addEventListener("DOMContentLoaded",function(t){jQuery.noConflict(),function(n,o){"use strict";var t;t=window.Japan.Navigation=window.Japan.Navigation||{},(t=function(t){this.cfg=o.extend({selectors:{logout:".navigation--wrapper [data-logout]",logout_confirm:"#settings--modal [data-logout-confirm]",settings_modal:"#settings--modal",user_form_button:"#settings--modal [data-update-button]",user_submit:"#settings--modal [data-update-submit]",form_back:"#settings--modal .form--back",user_inputs:"#settings--modal .input--wrapper",user_labels:"#settings--modal .update--label",user_password_confirm:"#settings--modal [data-password-confirm-wrapper]"}}),this.getDOMRefs(),this.bindHandlers()}).prototype.getDOMRefs=function(){this.$dom=this.$dom||{},o.forOwn(this.cfg.selectors,function(t,o){this.$dom[o]=n(t),this.$dom[o].length||alert("Navigation: Selected element not found")}.bind(this))},t.prototype.bindHandlers=function(){this.$dom.logout.on("click",this.handlerShowLogout.bind(this)),this.$dom.logout_confirm.on("click",this.handlerLogout.bind(this)),this.$dom.user_form_button.on("click",this.handlerShowSubForm.bind(this)),this.$dom.form_back.on("click",this.handlerFormGoBack.bind(this)),this.$dom.user_submit.on("click",this.handlerUpdateUser.bind(this))},t.prototype.handlerShowLogout=function(t){t.preventDefault(),this.handlerResetUserSettings(),this.$dom.settings_modal.modal({fadeDuration:500,fadeDelay:.5})},t.prototype.handlerLogout=function(){firebase.auth().signOut().then(function(t){window.location="/"}).catch(function(t){window.Japan.Error.handlerShowError(t)})},t.prototype.handlerShowSubForm=function(t){var o=n(t.target).data("update-button");this.$dom.user_form_button.hide();var e=n(t.target).next(".update--label");e.show(),e.next(".input--wrapper").show(),"password"===o&&this.$dom.user_password_confirm.show(),this.$dom.user_submit.css("display","block"),this.$dom.form_back.show(),this.$dom.logout_confirm.hide()},t.prototype.handlerFormGoBack=function(t){this.handlerResetUserSettings()},t.prototype.handlerResetUserSettings=function(t){this.$dom.user_form_button.show(),this.$dom.user_inputs.hide(),this.$dom.user_labels.hide(),this.$dom.user_submit.hide(),this.$dom.form_back.hide(),this.$dom.logout_confirm.show()},t.prototype.handlerUpdatePassword=function(t){var o=t.find(".input--field"),e=o[0].value,r=o[1].value;r!==e?window.Japan.Error.handlerShowError("Passwords do not match. Please re-enter your password now."):e.length<6||r.length<6?window.Japan.Error.handlerShowError("Password must be at least 6 characters."):user.updatePassword(e).then(function(){window.Japan.Error.handlerShowError("Password updated",!0),this.hideUserModal()}.bind(this)).catch(function(t){window.Japan.Error.handlerShowError(t)})},t.prototype.hideUserModal=function(){this.$dom.settings_modal.modal(),n(".jquery-modal.blocker").hide()},t.prototype.handlerUpdateEmail=function(t,o,e){t.updateEmail(o).then(function(){window.Japan.Error.handlerShowError("Email updated",!0);var t=JSON.parse(localStorage.getItem("user"));t[e]=o,window.localStorage.setItem("user",JSON.stringify(t)),n("[data-user-"+e+"]").text(t[e]),this.hideUserModal()}.bind(this)).catch(function(t){window.Japan.Error.handlerShowError(t)})},t.prototype.handlerUpdateName=function(t,o,e){t.updateProfile({displayName:o}).then(function(){window.Japan.Error.handlerShowError("Name updated",!0);var t=JSON.parse(localStorage.getItem("user"));t[e]=o,window.localStorage.setItem("user",JSON.stringify(t)),n("[data-user-"+e+"]").text(t[e]),this.hideUserModal()}.bind(this)).catch(function(t){window.Japan.Error.handlerShowError(t)})},t.prototype.handlerUpdateUser=function(){var t,o,e=n("#settings--modal .input--wrapper:visible"),r=firebase.auth().currentUser;if(1<e.length)this.handlerUpdatePassword($wrapper);else{var a=e.find(".input--field");t=a.val().trim(),o=a.attr("data-update-text"),t.length&&("email"===o?this.handlerUpdateEmail(r,t,o):this.handlerUpdateName(r,t,o))}},new t}(window.jQuery,window._)});