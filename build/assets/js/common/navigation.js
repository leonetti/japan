document.addEventListener("DOMContentLoaded",function(t){jQuery.noConflict(),function(r,d){"use strict";var t,s,l;t=window.Japan.Navigation=window.Japan.Navigation||{},s=firebase.firestore().collection("activities"),l=firebase.storage(),(t=function(t){this.cfg=d.extend({selectors:{logout:".navigation--wrapper [data-logout]",logout_confirm:"#settings--modal [data-logout-confirm]",settings_modal:"#settings--modal",user_form_button:"#settings--modal [data-update-button]",user_submit:"#settings--modal [data-update-submit]",form_back:"#settings--modal .form--back",user_inputs:"#settings--modal .input--wrapper",user_labels:"#settings--modal .update--label",user_password_confirm:"#settings--modal [data-password-confirm-wrapper]",show_activity_modal:".navigation--wrapper [data-activity-modal]",activity_modal:"#activity--modal",activity_submit:"#activity--modal [data-activity-submit]",activity_title:'#activity--modal [data-activity="title"]',activity_subtitle:'#activity--modal [data-activity="subtitle"]',activity_description:'#activity--modal [data-activity="description"]',activity_price:'#activity--modal [data-activity="price"]',activity_file:'#activity--modal [data-activity="file"]'}}),this.getDOMRefs(),this.bindHandlers()}).prototype.getDOMRefs=function(){this.$dom=this.$dom||{},d.forOwn(this.cfg.selectors,function(t,i){this.$dom[i]=r(t),this.$dom[i].length||alert("Navigation: Selected element not found")}.bind(this))},t.prototype.bindHandlers=function(){this.$dom.logout.on("click",this.handlerShowLogout.bind(this)),this.$dom.logout_confirm.on("click",this.handlerLogout.bind(this)),this.$dom.user_form_button.on("click",this.handlerShowSubForm.bind(this)),this.$dom.form_back.on("click",this.handlerFormGoBack.bind(this)),this.$dom.user_submit.on("click",this.handlerUpdateUser.bind(this)),this.$dom.show_activity_modal.on("click",this.handlerShowActivityModal.bind(this)),this.$dom.activity_submit.on("click",this.handlerAddActivity.bind(this))},t.prototype.handlerAddActivity=function(t){t.preventDefault();var i=this.$dom.activity_title.val().trim(),a=this.$dom.activity_subtitle.val().trim(),e=this.$dom.activity_description.val().trim(),o=parseFloat(this.$dom.activity_price.val()),r=document.querySelector("input[type=file]").files[0],n={title:i,sub_title:a,description:e,price:o,users:[]};console.log("file: ",r),i?a?e?isNaN(o)?window.Japan.Error.handlerShowError("Please enter a valid price, if free enter 0."):r?(s.doc().set(n).then(function(){l.ref("/"+i+"/").put(r).then(function(t){d.isEmpty(window.Japan.Activities)||(window.Japan.Activities.emptyActivities(),window.Japan.Activities.getActivities(),window.Japan.Error.handlerShowError("Activity Added!",!0))}.bind(this)).catch(function(t){window.Japan.Error.handlerShowError("Can't update activities. Refresh page.")}.bind(this))}.bind(this)).catch(function(t){window.Japan.Error.handlerShowError("Can't update activities. Refresh page.")}.bind(this)),this.hideUserModal()):window.Japan.Error.handlerShowError("Please upload a picture."):window.Japan.Error.handlerShowError("Please enter a description."):window.Japan.Error.handlerShowError("Please enter a valid subtitle. i.e: Shopping Center."):window.Japan.Error.handlerShowError("Please enter a valid title.")},t.prototype.handlerShowActivityModal=function(t){t.preventDefault(),this.$dom.activity_modal.modal({fadeDuration:500,fadeDelay:.5})},t.prototype.handlerShowLogout=function(t){t.preventDefault(),this.handlerResetUserSettings(),this.$dom.settings_modal.modal({fadeDuration:500,fadeDelay:.5})},t.prototype.handlerLogout=function(){firebase.auth().signOut().then(function(t){window.location="/"}).catch(function(t){window.Japan.Error.handlerShowError(t)})},t.prototype.handlerShowSubForm=function(t){var i=r(t.target).data("update-button");this.$dom.user_form_button.hide();var a=r(t.target).next(".update--label");a.fadeIn("slow"),a.next(".input--wrapper").fadeIn("slow"),"password"===i&&this.$dom.user_password_confirm.fadeIn("slow"),this.$dom.user_submit.css("display","block"),this.$dom.form_back.fadeIn("slow"),this.$dom.logout_confirm.hide()},t.prototype.handlerFormGoBack=function(t){this.handlerResetUserSettings()},t.prototype.handlerResetUserSettings=function(t){this.$dom.user_form_button.show(),this.$dom.user_inputs.hide(),this.$dom.user_labels.hide(),this.$dom.user_submit.hide(),this.$dom.form_back.hide(),this.$dom.logout_confirm.show()},t.prototype.handlerUpdatePassword=function(t,i){var a=t.find(".input--field"),e=a[0].value,o=a[1].value;o!==e?window.Japan.Error.handlerShowError("Passwords do not match. Please re-enter your password now."):e.length<6||o.length<6?window.Japan.Error.handlerShowError("Password must be at least 6 characters."):i.updatePassword(e).then(function(){window.Japan.Error.handlerShowError("Password updated",!0),this.hideUserModal()}.bind(this)).catch(function(t){window.Japan.Error.handlerShowError(t)})},t.prototype.hideUserModal=function(){this.$dom.settings_modal.modal(),r(".jquery-modal.blocker").hide(),r("body").removeAttr("style")},t.prototype.handlerUpdateEmail=function(t,i,a){t.updateEmail(i).then(function(){window.Japan.Error.handlerShowError("Email updated",!0);var t=JSON.parse(localStorage.getItem("user"));t[a]=i,window.localStorage.setItem("user",JSON.stringify(t)),r("[data-user-"+a+"]").text(t[a]),this.hideUserModal()}.bind(this)).catch(function(t){window.Japan.Error.handlerShowError(t)})},t.prototype.handlerUpdateName=function(t,i,a){t.updateProfile({displayName:i}).then(function(){window.Japan.Error.handlerShowError("Name updated",!0);var t=JSON.parse(localStorage.getItem("user"));t[a]=i,window.localStorage.setItem("user",JSON.stringify(t)),r("[data-user-"+a+"]").text(t[a]),this.hideUserModal()}.bind(this)).catch(function(t){window.Japan.Error.handlerShowError(t)})},t.prototype.handlerUpdateUser=function(){var t,i,a=r("#settings--modal .input--wrapper:visible"),e=firebase.auth().currentUser;if(1<a.length)this.handlerUpdatePassword(a,e);else{var o=a.find(".input--field");t=o.val().trim(),i=o.attr("data-update-text"),t.length&&("email"===i?this.handlerUpdateEmail(e,t,i):this.handlerUpdateName(e,t,i))}},window.Japan.Navigation=new t}(window.jQuery,window._)});